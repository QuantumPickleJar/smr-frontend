{"version":3,"file":"18.736899e5.js","sources":["../../../../../../src/routes/mod/[modId]/version/[versionId]/+page.ts","../../../../../../src/lib/components/versions/VersionDescription.svelte","../../../../../../src/lib/components/versions/VersionInfo.svelte","../../../../../../src/routes/mod/[modId]/version/[versionId]/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\nimport { queryStore } from '@urql/svelte';\nimport { GetModVersionDocument } from '$lib/generated';\nimport { loadWaitForNoFetch } from '$lib/utils/gql';\n\nexport const load: PageLoad = async ({ params, parent }) => ({\n  ...params,\n  ...(await loadWaitForNoFetch({\n    version: queryStore({\n      query: GetModVersionDocument,\n      client: (await parent()).client,\n      variables: { version: params.versionId }\n    })\n  }))\n});\n","<script lang=\"ts\">\n  import { markdown } from '$lib/utils/markdown';\n\n  export let changelog!: string;\n</script>\n\n<div class=\"h-fit card p-4\">\n  <section>\n    <div class=\"markdown-content\">\n      {#await markdown(changelog) then changelogRendered}\n        <p>{@html changelogRendered}</p>\n      {/await}\n    </div>\n  </section>\n</div>\n","<script lang=\"ts\">\n  import type { Version } from '$lib/generated';\n  import { prettyBytes, prettyDate, prettyNumber } from '$lib/utils/formatting';\n  import { getTranslate } from '@tolgee/svelte';\n\n  export let version!: Pick<Version, 'created_at' | 'sml_version' | 'size' | 'stability' | 'downloads' | 'hash'>;\n\n  export const { t } = getTranslate();\n</script>\n\n<div class=\"card p-4\">\n  <section>\n    <div class=\"text-lg break-words\">\n      <h3 class=\"text-2xl my-4 font-bold\">Info</h3>\n      <span><strong>{$t('entry.created-at')}:</strong> {prettyDate(version.created_at)}</span><br />\n      <span><strong>{$t('downloads')}:</strong> {prettyNumber(version.downloads)}</span><br />\n      <span><strong>SML {$t('version')}:</strong> {version.sml_version}</span><br />\n      <span><strong>{$t('stability')}:</strong> {version.stability}</span><br />\n      <span><strong>{$t('size')}:</strong> {prettyBytes(version.size)}</span><br />\n      <span><strong>{$t('hash')}:</strong> {version.hash}</span>\n    </div>\n  </section>\n</div>\n","<script lang=\"ts\">\n  import { DeleteVersionDocument } from '$lib/generated';\n  import VersionDescription from '$lib/components/versions/VersionDescription.svelte';\n  import VersionInfo from '$lib/components/versions/VersionInfo.svelte';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import { API_REST } from '$lib/core';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { goto } from '$app/navigation';\n  import { user } from '$lib/stores/user';\n  import { base } from '$app/paths';\n  import { installMod } from '$lib/stores/launcher';\n  import { prettyArch } from '$lib/utils/formatting';\n  import { getContextClient } from '@urql/svelte';\n  import type { PageData } from './$types';\n  import { getModalStore, type ModalSettings, popup } from '@skeletonlabs/skeleton';\n\n  export let data: PageData;\n\n  const { modId, versionId, version } = data;\n\n  const client = getContextClient();\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  $: canUserEdit =\n    $user?.roles?.deleteContent ||\n    $version?.data?.getVersion.mod?.authors?.findIndex((author) => author.user_id == $user?.id) >= 0;\n\n  const deleteVersionFn = () => {\n    client\n      .mutation(DeleteVersionDocument, { versionId })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          errorMessage = 'Error deleting version: ' + value.error.message;\n          errorToast = true;\n        } else {\n          // TODO Toast or something\n          goto(base + '/mod/' + modId);\n        }\n      });\n  };\n\n  const deleteModal: ModalSettings = {\n    type: 'confirm',\n    title: 'Delete Version?',\n    body: 'Are you sure you wish to delete this version?',\n    response: (r: boolean) => {\n      if (r) {\n        deleteVersionFn();\n      }\n    }\n  };\n\n  const modalStore = getModalStore();\n</script>\n\n<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors\n      description=\"Information for mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\" />\n  {/if}\n</svelte:head>\n\n{#if $version.fetching}\n  <p>Loading...</p>\n{:else if $version.error}\n  <p>Oh no... {$version.error.message}</p>\n{:else if $version.data.getVersion}\n  <div class=\"grid gap-6 xlx:grid-flow-row\">\n    <div class=\"flex flex-wrap h-auto justify-between items-center\">\n      <h1 class=\"text-4xl font-bold\">\n        {$version.data.getVersion.mod.name}\n        Version {$version.data.getVersion.version}\n      </h1>\n\n      <div class=\"grid grid-flow-col gap-4\">\n        {#if canUserEdit}\n          <button\n            class=\"btn variant-ghost-primary\"\n            on:click={() => goto(base + '/mod/' + modId + '/version/' + versionId + '/edit')}>\n            Edit\n          </button>\n          <button class=\"btn variant-ghost-primary\" on:click={() => modalStore.trigger(deleteModal)}>Delete</button>\n        {/if}\n        {#if $version.data.getVersion.arch.length != 0}\n          <button\n            class=\"btn variant-ghost-primary\"\n            use:popup={{\n              event: 'focus-click',\n              target: 'versionArchDropdown',\n              placement: 'bottom',\n              closeQuery: 'a'\n            }}>\n            <span>Download</span>\n            <span class=\"material-icons\" style=\"margin: 0;\">arrow_drop_down</span>\n          </button>\n\n          <div class=\"card w-72 shadow-xl\" data-popup=\"versionArchDropdown\">\n            <nav class=\"list-nav\">\n              <ul>\n                {#each $version.data.getVersion.arch as arch}\n                  <li>\n                    <a\n                      class=\"w-full\"\n                      href={API_REST + '/mod/' + modId + '/versions/' + versionId + '/' + arch.platform + '/download'}>\n                      <span>Download {prettyArch(arch.platform)}</span>\n                    </a>\n                  </li>\n                {/each}\n              </ul>\n            </nav>\n          </div>\n        {:else}\n          <a class=\"btn variant-ghost-primary\" href={base + '/mod/' + modId + '/version/' + versionId}>View</a>\n          <a\n            class=\"btn variant-ghost-primary\"\n            href={API_REST + '/mod/' + modId + '/versions/' + versionId + '/download'}>Download</a>\n        {/if}\n        <button\n          class=\"btn variant-ghost-primary\"\n          on:click={() => installMod($version.data.getVersion.mod.mod_reference)}>\n          <span>Install</span>\n          <span class=\"material-icons\">download</span>\n        </button>\n\n        <a class=\"btn variant-ghost-primary\" href={base + '/mod/' + modId}>\n          <span>Mod</span>\n          <span class=\"material-icons\">extension</span>\n        </a>\n      </div>\n    </div>\n    <div class=\"grid grid-auto-max auto-cols-fr gap-4\">\n      <VersionDescription changelog={$version.data.getVersion.changelog} />\n      <div class=\"grid grid-cols-1 auto-rows-min gap-8\">\n        <VersionInfo version={$version.data.getVersion} />\n      </div>\n    </div>\n  </div>\n\n  <Toast bind:running={errorToast}>\n    <span>{errorMessage}</span>\n  </Toast>\n{:else}\n  <!-- TODO Better 404 -->\n  404\n{/if}\n"],"names":["load","async","params","parent","n","loadWaitForNoFetch","version","queryStore","query","GetModVersionDocument","client","variables","versionId","ctx","insert_hydration_dev","target","p","anchor","innerHTML","raw_value","handle_promise","promise","markdown","info","div1","append_hydration_dev","section","div0","dirty","changelog","$$props","t2_value","prettyDate","created_at","t7_value","prettyNumber","downloads","t13_value","t16_value","sml_version","t18_value","t21_value","stability","t23_value","prettyBytes","size","t28_value","t31_value","hash","h3","span0","strong0","br0","span1","strong1","br1","span2","strong2","br2","span3","strong3","br3","span4","strong4","br4","span5","strong5","set_data_dev","t2","t5","t5_value","t7","t10","t10_value","t13","t16","t18","t21","t23","t26","t26_value","t28","t31","t","getTranslate","description","data","getVersion","mod","name","title","metadescriptors_changes","t0_value","create_if_block_4","arch","length","create_if_block_3","base","div4","h1","button","a","div3","div2","current","t0","versiondescription_changes","error","message","t1","t1_value","button0","button1","attr_dev","a0","API_REST","a1","each_value","i","div","nav","ul","event","placement","closeQuery","prettyArch","platform","a_href_value","li","span","fetching","create_if_block_5","modId","getContextClient","errorMessage","errorToast","deleteVersionFn","mutation","DeleteVersionDocument","toPromise","then","value","console","$$invalidate","goto","deleteModal","type","body","response","r","modalStore","getModalStore","trigger","installMod","$version","mod_reference","canUserEdit","$user","roles","deleteContent","authors","findIndex","author","user_id","id"],"mappings":"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"}