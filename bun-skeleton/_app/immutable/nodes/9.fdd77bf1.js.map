{"version":3,"file":"9.fdd77bf1.js","sources":["../../../../../../src/routes/admin/unapproved-versions/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { ApproveVersionDocument, DenyVersionDocument, GetUnapprovedVersionsDocument } from '$lib/generated';\n  import { getContextClient, queryStore } from '@urql/svelte';\n  import { API_REST } from '$lib/core';\n  import { base } from '$app/paths';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import { prettyDate } from '$lib/utils/formatting';\n  import { type PaginationSettings, Paginator } from '@skeletonlabs/skeleton';\n\n  const client = getContextClient();\n\n  let perPage = 20;\n  let page = 1;\n\n  $: versions = queryStore({\n    query: GetUnapprovedVersionsDocument,\n    client,\n    variables: {\n      filter: {\n        offset: (page - 1) * perPage,\n        limit: perPage\n      }\n    }\n  });\n\n  $: totalVersions = $versions?.data?.getUnapprovedVersions?.count;\n\n  const approveVersion = (versionId: string) => {\n    client\n      .mutation(ApproveVersionDocument, { versionId })\n      .toPromise()\n      .then(() => {\n        versions.pause();\n        versions.resume();\n      });\n  };\n\n  const denyVersion = (versionId: string) => {\n    client\n      .mutation(DenyVersionDocument, { versionId })\n      .toPromise()\n      .then(() => {\n        versions.pause();\n        versions.resume();\n      });\n  };\n\n  $: paginationSettings = {\n    page: page,\n    limit: perPage,\n    size: totalVersions,\n    amounts: [5, 10, 20, 50, 100]\n  } satisfies PaginationSettings;\n</script>\n\n<svelte:head>\n  <MetaDescriptors description=\"Unapproved mod versions\" title=\"Admin: Unapproved Versions\" />\n</svelte:head>\n\n{#if totalVersions}\n  <div class=\"mb-5 ml-auto flex justify-end\">\n    <div>\n      <Paginator\n        bind:settings={paginationSettings}\n        showFirstLastButtons={true}\n        showPreviousNextButtons={true}\n        on:page={(p) => (page = p.detail)}\n        on:amount={(p) => (perPage = p.detail)}\n        controlVariant=\"variant-filled-surface\" />\n    </div>\n  </div>\n{/if}\n\n<div class=\"card\">\n  {#if $versions.fetching}\n    <section class=\"p-4\">Loading...</section>\n  {:else if $versions.error}\n    <section class=\"p-4\">Oh no... {$versions.error.message}</section>\n  {:else}\n    <table class=\"max-w-full table table-hover\">\n      <thead>\n        <tr>\n          <th>Mod</th>\n          <th>Version</th>\n          <th>Release Date</th>\n          <th><!-- Buttons --></th>\n        </tr>\n      </thead>\n      <tbody>\n        {#each $versions.data.getUnapprovedVersions.versions as version}\n          <tr>\n            <td>{version.mod.name}</td>\n            <td>{version.version}</td>\n            <td>{prettyDate(version.created_at)}</td>\n            <td>\n              <div class=\"grid grid-flow-col gap-4\">\n                <button class=\"btn variant-ghost-primary\" on:click={() => approveVersion(version.id)}>Approve</button>\n                <button class=\"btn variant-ghost-primary\" on:click={() => denyVersion(version.id)}>Deny</button>\n                <a\n                  class=\"btn variant-ghost-primary\"\n                  href={API_REST + '/mod/' + version.mod_id + '/versions/' + version.id + '/download'}>\n                  Download\n                </a>\n                <a class=\"btn variant-ghost-primary\" href={base + '/mod/' + version.mod_id + '/version/' + version.id}>\n                  View\n                </a>\n              </div>\n            </td>\n          </tr>\n        {/each}\n      </tbody>\n    </table>\n  {/if}\n</div>\n\n{#if totalVersions}\n  <div class=\"mt-5 ml-auto flex justify-end\">\n    <Paginator\n      bind:settings={paginationSettings}\n      showFirstLastButtons={true}\n      showPreviousNextButtons={true}\n      on:page={(p) => (page = p.detail)}\n      on:amount={(p) => (perPage = p.detail)}\n      controlVariant=\"variant-filled-surface\" />\n  </div>\n{/if}\n"],"names":["ctx","insert_hydration_dev","target","div1","anchor","append_hydration_dev","div0","each_value","data","getUnapprovedVersions","versions","length","i","table","thead","tr","th0","th1","th2","th3","tbody","error","message","section","set_data_dev","t1","t1_value","mod","name","t2_value","version","prettyDate","created_at","attr_dev","a0","a0_href_value","API_REST","mod_id","id","base","td0","td1","td2","td3","div","button0","button1","a1","t0","t0_value","dirty","t2","t4","t4_value","create_if_block_3","fetching","create_if_block_1","create_if_block_2","create_if_block","client","getContextClient","perPage","page","approveVersion","versionId","mutation","ApproveVersionDocument","toPromise","then","pause","resume","denyVersion","DenyVersionDocument","paginationSettings","value","page_handler","p","$$invalidate","detail","amount_handler","page_handler_1","amount_handler_1","$$subscribe_versions","queryStore","query","GetUnapprovedVersionsDocument","variables","filter","offset","limit","totalVersions","$versions","count","size","amounts"],"mappings":"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"}