import{aF as K,S as Z,i as Q,s as W,bh as tt,p as et,P as rt,e as j,R as k,u as E,I as D,U as q,a_ as at,d as p,V as z,v as P,w as V,J as F,X as O,Y as _,Z as w,a as b,_ as T,b as N,t as S,c as X,a4 as nt,a5 as A,aD as ot,a8 as H,a9 as R,bi as st,g as Y,aG as it,aN as lt,K as L,L as U,aq as B}from"../chunks/vendor.1ec771a9.js";import{T as ct}from"../chunks/Toast.060cf690.js";import{V as ft}from"../chunks/VersionForm.954b4508.js";import{z as dt,F as ut,B as mt,H as pt,I as $t}from"../chunks/graphql.22d32a05.js";import{M as ht}from"../chunks/MetaDescriptors.62de29c1.js";const gt=async({params:s})=>({...s}),Ut=Object.freeze(Object.defineProperty({__proto__:null,load:gt},Symbol.toStringTag,{value:"Module"})),vt=async(s,t,a,e,n)=>{const o=Math.ceil(s.size/1e7),u=new Array(o).fill(0).map((c,f)=>f).reverse(),l=(c,f,g)=>n.mutation(pt,{modId:t,versionId:g,part:f,file:c}).toPromise(),$=10;let h=0,m=0;const x=c=>{if(h>=$||!u.length)return;const f=u.pop(),g=f*1e7,v=s.slice(g,g+1e7);return h+=1,Promise.all([l(v,f+1,c).then(()=>(h-=1,e.set({total:o,uploaded:o-u.length-h}),x(c))).catch(r=>{if(console.error("Upload failed:",r),h-=1,u.push(f),m+=1,m<5)return x(c);throw new Error("Failed uploading after 5 attempts")}),x(c)])};return n.mutation(dt,{modId:t}).toPromise().then(async c=>(e.set({total:o,uploaded:0}),await x(c.data.createVersion),c.data.createVersion)).then(c=>(console.log("Finalizing",{versionID:c}),n.mutation(ut,{modId:t,versionId:c,version:a}).toPromise().then(()=>new Promise((f,g)=>{let v=0,r=K({query:mt,client:n,variables:{modId:t,versionId:c},requestPolicy:"network-only"});const d=setInterval(()=>{if(v==60)return clearInterval(d),g(new Error("Timed out waiting for mod processing"));r.pause(),r.resume(),v++},1e4),y=r.subscribe(I=>{if(!I.fetching){if(I.error){clearInterval(d),g(new Error(I.error.message)),setTimeout(y);return}I.data?.checkVersionUploadState?.version?.id&&(y(),clearInterval(d),f(I.data.checkVersionUploadState))}})})))).catch(c=>{throw console.error(c),c})};function G(s){let t,a;return t=new ht({props:{description:"Creating a new version of mod "+s[2].data.mod.name,title:"New version of mod "+s[2].data.mod.name}}),{c(){q(t.$$.fragment)},l(e){O(t.$$.fragment,e)},m(e,n){T(t,e,n),a=!0},p(e,n){const i={};n&4&&(i.description="Creating a new version of mod "+e[2].data.mod.name),n&4&&(i.title="New version of mod "+e[2].data.mod.name),t.$set(i)},i(e){a||(N(t.$$.fragment,e),a=!0)},o(e){S(t.$$.fragment,e),a=!1},d(e){A(t,e)}}}function wt(s){let t=s[2].data.mod.name+"",a;return{c(){a=D(t)},l(e){a=F(e,t)},m(e,n){b(e,a,n)},p(e,n){n&4&&t!==(t=e[2].data.mod.name+"")&&L(a,t)},d(e){e&&p(a)}}}function xt(s){let t;return{c(){t=D("...")},l(a){t=F(a,"...")},m(a,e){b(a,t,e)},p:U,d(a){a&&p(t)}}}function bt(s){let t,a,e,n;t=new ft({props:{onSubmit:s[8],modReference:s[2].data.mod.mod_reference}});let i=s[3]&&J(s);return{c(){q(t.$$.fragment),a=k(),i&&i.c(),e=j()},l(o){O(t.$$.fragment,o),a=z(o),i&&i.l(o),e=j()},m(o,u){T(t,o,u),b(o,a,u),i&&i.m(o,u),b(o,e,u),n=!0},p(o,u){const l={};u&4&&(l.modReference=o[2].data.mod.mod_reference),t.$set(l),o[3]?i?i.p(o,u):(i=J(o),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i(o){n||(N(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){A(t,o),o&&p(a),i&&i.d(o),o&&p(e)}}}function yt(s){let t,a,e=s[2].error.message+"",n;return{c(){t=E("p"),a=D("Oh no... "),n=D(e)},l(i){t=P(i,"P",{});var o=V(t);a=F(o,"Oh no... "),n=F(o,e),o.forEach(p)},m(i,o){b(i,t,o),w(t,a),w(t,n)},p(i,o){o&4&&e!==(e=i[2].error.message+"")&&L(n,e)},i:U,o:U,d(i){i&&p(t)}}}function It(s){let t,a;return{c(){t=E("p"),a=D("Loading...")},l(e){t=P(e,"P",{});var n=V(t);a=F(n,"Loading..."),n.forEach(p)},m(e,n){b(e,t,n),w(t,a)},p:U,i:U,o:U,d(e){e&&p(t)}}}function J(s){let t,a,e,n,i,o,u,l,$=s[4].toFixed(0)+"",h,m,x,c,f;return{c(){t=E("div"),a=E("div"),e=E("div"),n=E("span"),i=D(s[3]),o=k(),u=E("div"),l=E("span"),h=D($),m=D("%"),x=k(),c=E("div"),f=E("div"),this.h()},l(g){t=P(g,"DIV",{class:!0});var v=V(t);a=P(v,"DIV",{class:!0});var r=V(a);e=P(r,"DIV",{});var d=V(e);n=P(d,"SPAN",{class:!0});var y=V(n);i=F(y,s[3]),y.forEach(p),d.forEach(p),o=z(r),u=P(r,"DIV",{class:!0});var I=V(u);l=P(I,"SPAN",{class:!0});var M=V(l);h=F(M,$),m=F(M,"%"),M.forEach(p),I.forEach(p),r.forEach(p),x=z(v),c=P(v,"DIV",{class:!0});var C=V(c);f=P(C,"DIV",{style:!0,class:!0}),V(f).forEach(p),C.forEach(p),v.forEach(p),this.h()},h(){_(n,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-white bg-yellow-600"),_(l,"class","text-xs font-semibold inline-block text-white"),_(u,"class","text-right"),_(a,"class","flex mb-2 items-center justify-between"),B(f,"width",s[4].toFixed(0)+"%"),_(f,"class","shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-600"),_(c,"class","overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-600"),_(t,"class","relative pt-4")},m(g,v){b(g,t,v),w(t,a),w(a,e),w(e,n),w(n,i),w(a,o),w(a,u),w(u,l),w(l,h),w(l,m),w(t,x),w(t,c),w(c,f)},p(g,v){v&8&&L(i,g[3]),v&16&&$!==($=g[4].toFixed(0)+"")&&L(h,$),v&16&&B(f,"width",g[4].toFixed(0)+"%")},d(g){g&&p(t)}}}function Et(s){let t,a,e,n;const i=[It,yt,bt],o=[];function u(l,$){return l[2].fetching?0:l[2].error?1:2}return t=u(s),a=o[t]=i[t](s),{c(){a.c(),e=j()},l(l){a.l(l),e=j()},m(l,$){o[t].m(l,$),b(l,e,$),n=!0},p(l,$){let h=t;t=u(l),t===h?o[t].p(l,$):(Y(),S(o[h],1,1,()=>{o[h]=null}),X(),a=o[t],a?a.p(l,$):(a=o[t]=i[t](l),a.c()),N(a,1),a.m(e.parentNode,e))},i(l){n||(N(a),n=!0)},o(l){S(a),n=!1},d(l){o[t].d(l),l&&p(e)}}}function Pt(s){let t,a;return t=new st({props:{$$slots:{default:[Et]},$$scope:{ctx:s}}}),{c(){q(t.$$.fragment)},l(e){O(t.$$.fragment,e)},m(e,n){T(t,e,n),a=!0},p(e,n){const i={};n&16412&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){a||(N(t.$$.fragment,e),a=!0)},o(e){S(t.$$.fragment,e),a=!1},d(e){A(t,e)}}}function Vt(s){let t,a;return{c(){t=E("span"),a=D(s[1])},l(e){t=P(e,"SPAN",{});var n=V(t);a=F(n,s[1]),n.forEach(p)},m(e,n){b(e,t,n),w(t,a)},p(e,n){n&2&&L(a,e[1])},d(e){e&&p(t)}}}function Nt(s){let t,a,e,n,i,o,u,l,$,h,m=!s[2].fetching&&!s[2].error&&s[2].data.mod&&G(s);function x(r,d){if(r[2].fetching)return xt;if(!r[2].error)return wt}let c=x(s),f=c&&c(s);o=new tt({props:{$$slots:{default:[Pt]},$$scope:{ctx:s}}});function g(r){s[10](r)}let v={$$slots:{default:[Vt]},$$scope:{ctx:s}};return s[0]!==void 0&&(v.running=s[0]),l=new ct({props:v}),et.push(()=>rt(l,"running",g)),{c(){m&&m.c(),t=j(),a=k(),e=E("h1"),n=D(`New Version for
  `),f&&f.c(),i=k(),q(o.$$.fragment),u=k(),q(l.$$.fragment),this.h()},l(r){const d=at("svelte-nx2zao",document.head);m&&m.l(d),t=j(),d.forEach(p),a=z(r),e=P(r,"H1",{class:!0});var y=V(e);n=F(y,`New Version for
  `),f&&f.l(y),y.forEach(p),i=z(r),O(o.$$.fragment,r),u=z(r),O(l.$$.fragment,r),this.h()},h(){_(e,"class","text-4xl my-4 font-bold")},m(r,d){m&&m.m(document.head,null),w(document.head,t),b(r,a,d),b(r,e,d),w(e,n),f&&f.m(e,null),b(r,i,d),T(o,r,d),b(r,u,d),T(l,r,d),h=!0},p(r,[d]){!r[2].fetching&&!r[2].error&&r[2].data.mod?m?(m.p(r,d),d&4&&N(m,1)):(m=G(r),m.c(),N(m,1),m.m(t.parentNode,t)):m&&(Y(),S(m,1,1,()=>{m=null}),X()),c===(c=x(r))&&f?f.p(r,d):(f&&f.d(1),f=c&&c(r),f&&(f.c(),f.m(e,null)));const y={};d&16412&&(y.$$scope={dirty:d,ctx:r}),o.$set(y);const I={};d&16386&&(I.$$scope={dirty:d,ctx:r}),!$&&d&1&&($=!0,I.running=r[0],nt(()=>$=!1)),l.$set(I)},i(r){h||(N(m),N(o.$$.fragment,r),N(l.$$.fragment,r),h=!0)},o(r){S(m),S(o.$$.fragment,r),S(l.$$.fragment,r),h=!1},d(r){m&&m.d(r),p(t),r&&p(a),r&&p(e),f&&f.d(),r&&p(i),A(o,r),r&&p(u),A(l,r)}}}function Dt(s,t,a){let e,n,i,o,{data:u}=t;const l=ot(),$=H("");R(s,$,r=>a(3,i=r));const h=H(0);R(s,h,r=>a(4,o=r));const m=H();m.subscribe(r=>{r&&(r.uploaded===r.total?($.set("Processing..."),h.set(100)):($.set(`Uploading: ${r.uploaded}/${r.total}`),h.set(r.uploaded/r.total*100)))});let x="",c=!1;const f=K({query:$t,client:l,variables:{mod:e}});R(s,f,r=>a(2,n=r));const g=async r=>vt(r.file,n.data.mod.id,{changelog:r.changelog,stability:r.stability},m,l).then(d=>{console.log({success:d}),it(lt+"/mod/"+e+"/version/"+d.version.id)}).catch(d=>{console.error(d),a(1,x="Error creating version: "+d.message),a(0,c=!0),$.set("")});function v(r){c=r,a(0,c)}return s.$$set=r=>{"data"in r&&a(9,u=r.data)},s.$$.update=()=>{s.$$.dirty&512&&({modId:e}=u),s.$$.dirty&1&&(c||a(1,x=""))},[c,x,n,i,o,$,h,f,g,u,v]}class jt extends Z{constructor(t){super(),Q(this,t,Dt,Nt,W,{data:9})}}export{jt as component,Ut as universal};
//# sourceMappingURL=18.71faf591.js.map
