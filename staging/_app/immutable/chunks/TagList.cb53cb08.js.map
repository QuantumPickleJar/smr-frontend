{"version":3,"file":"TagList.cb53cb08.js","sources":["../../../../../../src/lib/components/utils/TagList.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { GetTagsDocument } from '$lib/generated/graphql';\n  import type { Tag } from '$lib/generated/graphql';\n  import Chip, { Set, Text } from '@smui/chips';\n  import MenuSurface from '@smui/menu-surface';\n  import { queryStore, getContextClient } from '@urql/svelte';\n  import Textfield, { Input } from '@smui/textfield';\n  import FloatingLabel from '@smui/floating-label';\n  import LineRipple from '@smui/line-ripple';\n\n  const client = getContextClient();\n\n  const getAllTags = queryStore({\n    query: GetTagsDocument,\n    client,\n    variables: {}\n  });\n\n  export let tags: Tag[] = [];\n  export let editable = false;\n\n  let inputA: Input;\n  let lineRippleA: LineRipple;\n\n  let shake = false;\n\n  let allTags: Tag[] = [];\n  let filteredTagsMatched: Tag[] = [];\n  let filteredTagsUnmatched: Tag[] = [];\n\n  let newTagText: string;\n\n  let newTag: HTMLInputElement;\n  let newTagContainer: HTMLElement = null;\n  let surface: MenuSurface;\n\n  let focused = false;\n\n  $: newTag = inputA?.getElement();\n\n  function filterAvailableTags(tagList: Tag[], currentTags: Tag[], filterText: string): [Tag[], Tag[]] {\n    if (!tagList || !currentTags) {\n      return [tagList, tagList];\n    }\n    let unfiltered = tagList.filter((tag) => !currentTags.find((t) => t.id == tag.id));\n    const filtered = unfiltered.filter((tag) => !newTag || tag.name.startsWith(filterText));\n    unfiltered = unfiltered.filter((tag) => filtered.findIndex((t) => t.id === tag.id) === -1);\n    return [filtered, unfiltered];\n  }\n\n  function updateTags() {\n    tags = tags;\n    [filteredTagsMatched, filteredTagsUnmatched] = filterAvailableTags(allTags, tags, newTagText);\n  }\n\n  $: if (editable) {\n    if (!$getAllTags.fetching && !$getAllTags.error) {\n      allTags = $getAllTags.data?.getTags || [];\n      updateTags();\n    }\n  }\n\n  function setTagText(text: string) {\n    newTagText = text;\n    newTag.value = newTagText;\n  }\n\n  export function setTextRange(el: HTMLInputElement, start: number, end: number): void {\n    el.focus();\n    if (typeof window.getSelection != 'undefined' && typeof document.createRange != 'undefined') {\n      el.setSelectionRange(start, end);\n    }\n  }\n\n  export function placeCaretAtEnd(el: HTMLInputElement): void {\n    el.focus();\n    if (typeof window.getSelection != 'undefined' && typeof document.createRange != 'undefined') {\n      el.setSelectionRange(el.value.length, el.value.length);\n    }\n  }\n\n  function addTag(newTagObj: string | Tag) {\n    if (!allTags) {\n      return false;\n    }\n    const tagToAdd = allTags.find((tag) => {\n      if (typeof newTagObj == 'string') {\n        return newTagObj == tag.name || newTagObj == tag.id;\n      } else {\n        return newTagObj.id == tag.id;\n      }\n    }) as Tag;\n    if (tagToAdd && !tags.find((tag) => tag.id == tagToAdd.id)) {\n      tags.push(tagToAdd);\n      updateTags();\n      return true;\n    }\n    updateTags();\n    return false;\n  }\n\n  function deleteTag(tag: Tag) {\n    tags = tags.filter((v) => v != tag);\n    updateTags();\n  }\n\n  function newTagKeydown(e: Event) {\n    if (!(e instanceof KeyboardEvent)) {\n      return;\n    }\n    if (e.code == 'Backspace') {\n      if (newTag.value == '') {\n        setTagText(tags.pop().name);\n        placeCaretAtEnd(newTag);\n        tags = tags;\n        e.preventDefault();\n        updateTags();\n      }\n    } else if (e.code == 'Enter') {\n      e.preventDefault();\n      if (addTag(newTag.value)) {\n        setTagText('');\n        updateTags();\n      } else {\n        shake = true;\n        setTimeout(() => (shake = false), 500);\n      }\n    } else {\n      const newText = newTagText + e.key;\n      const [available] = filterAvailableTags(allTags, tags, newText);\n      if (available && available.length > 0) {\n        newTag.value = available[0].name;\n        setTextRange(newTag, newTagText.length + 1, newTag.value.length);\n        e.preventDefault();\n        newTagText = newText;\n        updateTags();\n      }\n    }\n  }\n\n  function onFocusLost() {\n    setTimeout(() => {\n      if (newTagContainer && !newTagContainer.contains(document.activeElement)) {\n        surface.setOpen(false);\n      }\n    }, 200);\n  }\n\n  function onInput(e: Event) {\n    newTagText = newTag.value;\n    updateTags();\n    e.preventDefault();\n  }\n</script>\n\n<div class=\"tags\" on:focusin={() => (focused = true)} on:focusout={() => (focused = false)}>\n  {#if !editable}\n    {#if tags.length > 0}\n      <div class=\"flex flex-row flex-wrap text-sm gap-1\">\n        {#each tags as tag}\n          <div class=\"text-neutral-300 lowercase\">\n            <span class=\"text-orange-500\">#</span>{tag.name}\n          </div>\n        {/each}\n      </div>\n    {/if}\n  {:else}\n    <Textfield class=\"tags overflow-visible\" bind:lineRipple={lineRippleA} bind:input={inputA} style=\"z-index: 9999\">\n      <FloatingLabel\n        class=\"pb-2\"\n        for=\"input-manual-a\"\n        slot=\"label\"\n        floatAbove={(newTag && newTag.value.length > 0) || focused || tags.length > 0}>Tags</FloatingLabel>\n      <div class=\"flex flex-row flex-wrap text-sm gap-1 mr-2\">\n        {#each tags as tag}\n          <div class=\"text-neutral-300 whitespace-nowrap flex removable-tag\">\n            <span class=\"hashtag text-orange-500\">#</span>\n            <span class=\"cancel\">\n              <i class=\"material-icons mdc-chip__icon mdc-chip__icon--trailing\" on:click={() => deleteTag(tag)}\n                >cancel</i>\n            </span>\n            <p>{tag.name}</p>\n          </div>\n        {/each}\n        <div\n          id=\"newTagContainer\"\n          class=\"text-neutral-300 whitespace-nowrap flex\"\n          bind:this={newTagContainer}\n          on:focusin={() => surface.setOpen(true)}\n          on:focusout={onFocusLost}>\n          <MenuSurface bind:this={surface} managed={true} anchorCorner=\"BOTTOM_LEFT\" anchorElement={newTag}>\n            <div style=\"margin: 1rem\">\n              <h1>Available Tags</h1>\n              <div class=\"flex flex-wrap m-1\">\n                <Set chips={filteredTagsMatched} let:chip key={(tag) => tag.name}>\n                  <Chip {chip} on:SMUIChip:interaction={() => addTag(chip.name)}>\n                    <Text>{chip.name}</Text>\n                  </Chip>\n                </Set>\n              </div>\n              <div class=\"flex flex-wrap m-1\">\n                <Set chips={filteredTagsUnmatched} let:chip key={(tag) => tag.name}>\n                  <Chip {chip} on:SMUIChip:interaction={() => addTag(chip.name)}>\n                    <Text>{chip.name}</Text>\n                  </Chip>\n                </Set>\n              </div>\n            </div>\n          </MenuSurface>\n          {#if focused}\n            <span class=\"text-orange-500\">#</span>\n          {/if}\n          <Input\n            id=\"input-manual-a\"\n            spellcheck=\"false\"\n            autocomplete=\"off\"\n            class=\"inline text-sm text-neutral-300 {shake ? 'shake' : ''}\"\n            style=\"height: initial\"\n            bind:this={inputA}\n            on:keydown={newTagKeydown}\n            on:input={onInput} />\n        </div>\n      </div>\n      <LineRipple bind:this={lineRippleA} slot=\"ripple\" />\n    </Textfield>\n  {/if}\n</div>\n\n<style lang=\"scss\">\n  .removable-tag {\n    .cancel {\n      display: none;\n      cursor: pointer;\n\n      i {\n        padding: 0;\n        margin: 0;\n      }\n    }\n\n    &:hover {\n      .hashtag {\n        display: none;\n      }\n\n      .cancel {\n        display: initial;\n      }\n    }\n  }\n</style>\n"],"names":["ctx","length","create_if_block_1","t4_value","name","insert_hydration_dev","target","div","anchor","append_hydration_dev","span0","span1","i","p","dirty","set_data_dev","t4","t_value","t","div2","h1","div0","div1","span","create_if_block_2","floatAbove","value","floatinglabel_changes","t1_value","t1","setTextRange","el","start","end","focus","window","getSelection","document","createRange","setSelectionRange","placeCaretAtEnd","tag","client","getContextClient","getAllTags","queryStore","query","GetTagsDocument","variables","tags","$$props","editable","inputA","lineRippleA","shake","allTags","filteredTagsMatched","filteredTagsUnmatched","newTagText","newTag","newTagContainer","surface","focused","filterAvailableTags","tagList","currentTags","filterText","unfiltered","filter","find","id","filtered","startsWith","findIndex","updateTags","$$invalidate","setTagText","text","addTag","newTagObj","tagToAdd","push","deleteTag","v","newTagKeydown","e","KeyboardEvent","code","pop","preventDefault","setTimeout","newText","key","available","onFocusLost","contains","activeElement","setOpen","onInput","$$value","click_handler","chip","focusin_handler_1","focusout_handler","getElement","$getAllTags","fetching","error","data","getTags"],"mappings":"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"}