{"version":3,"file":"11.66e2e375.js","sources":["../../../../../../src/routes/guide/[guideId]/+page.ts","../../../../../../src/lib/components/guides/GuideInfo.svelte","../../../../../../src/lib/components/guides/GuideAuthor.svelte","../../../../../../src/routes/guide/[guideId]/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\nimport { queryStore } from '@urql/svelte';\nimport { GetGuideDocument } from '$lib/generated';\nimport { loadWaitForNoFetch } from '$lib/utils/gql';\n\nexport const load: PageLoad = async ({ params, parent }) => ({\n  ...params,\n  ...(await loadWaitForNoFetch({\n    guide: queryStore({\n      query: GetGuideDocument,\n      client: (await parent()).client,\n      variables: { guide: params.guideId }\n    })\n  }))\n});\n","<script lang=\"ts\">\n  import type { Guide } from '$lib/generated';\n  import Card, { Content } from '@smui/card';\n  import { prettyDate } from '$lib/utils/formatting';\n\n  export let guide!: Pick<Guide, 'created_at'>;\n</script>\n\n<Card>\n  <Content>\n    <div class=\"text-lg\">\n      <h3 class=\"text-2xl my-4 font-bold\">Info</h3>\n      <span><strong>Created:</strong> {prettyDate(guide.created_at)}</span><br />\n    </div>\n  </Content>\n</Card>\n","<script lang=\"ts\">\n  import type { User } from '$lib/generated';\n  import { base } from '$app/paths';\n  import Card, { Content } from '@smui/card';\n\n  export let author: Pick<User, 'id' | 'username' | 'avatar'>;\n</script>\n\n<Card>\n  <Content>\n    <div class=\"grid grid-flow-row gap-y-2\">\n      <h3 class=\"text-2xl my-4 font-bold\">Author</h3>\n\n      <div class=\"grid auto-rows-min text-lg gap-y-4\">\n        <div class=\"grid grid-flow-col auto-cols-min gap-x-4\">\n          <div class=\"rounded-full bg-cover w-14 h-14\" style={`background-image: url(\"${author.avatar}\")`} />\n          <div class=\"grid grid-flow-row\">\n            <a href=\"{base}/user/{author.id}/\" class=\"text-yellow-500 underline\">{author.username}</a>\n            <div>Writer</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </Content>\n</Card>\n","<script lang=\"ts\">\n  import { DeleteGuideDocument } from '$lib/generated';\n  import GuideInfo from '$lib/components/guides/GuideInfo.svelte';\n  import GuideAuthor from '$lib/components/guides/GuideAuthor.svelte';\n  import { user } from '$lib/stores/user';\n  import { goto } from '$app/navigation';\n  import { writable } from 'svelte/store';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { markdown } from '$lib/utils/markdown';\n  import { base } from '$app/paths';\n  import Dialog, { Title, Content as DialogContent } from '@smui/dialog';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import Card, { Content } from '@smui/card';\n  import Button from '@smui/button';\n  import { getContextClient } from '@urql/svelte';\n  import type { PageData } from './$types';\n\n  export let data: PageData;\n\n  const { guideId, guide } = data;\n\n  const client = getContextClient();\n\n  let errorMessage = '';\n  let errorToast = false;\n\n  $: canUserEdit = $user?.roles?.deleteContent || $user?.id === $guide?.data?.getGuide?.user?.id;\n\n  const deleteDialogOpen = writable<boolean>(false);\n\n  const deleteGuideFn = () => {\n    client\n      .mutation(DeleteGuideDocument, { guideId })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          errorMessage = 'Error deleting guide: ' + value.error.message;\n          errorToast = true;\n        } else {\n          // TODO Toast or something\n          goto(base + '/guides');\n        }\n      });\n  };\n\n  $: if (!errorToast) {\n    errorMessage = '';\n  }\n</script>\n\n<svelte:head>\n  {#if !$guide.fetching && !$guide.error && $guide.data.getGuide}\n    <MetaDescriptors description={$guide.data.getGuide.short_description} title={$guide.data.getGuide.name} />\n  {/if}\n</svelte:head>\n\n{#if $guide.fetching}\n  <p>Loading...</p>\n{:else if $guide.error}\n  <p>Oh no... {$guide.error.message}</p>\n{:else if $guide.data.getGuide}\n  <div class=\"grid gap-6 xlx:grid-flow-row\">\n    <div class=\"flex flex-wrap h-auto justify-between items-center\">\n      <h1 class=\"text-4xl font-bold\">{$guide.data.getGuide.name}</h1>\n\n      <div>\n        {#if canUserEdit}\n          <Button variant=\"outlined\" on:click={() => goto(base + '/guide/' + guideId + '/edit')}>Edit</Button>\n          <Button variant=\"outlined\" on:click={() => deleteDialogOpen.set(true)}>Delete</Button>\n        {/if}\n      </div>\n    </div>\n    <div class=\"grid grid-auto-max auto-cols-fr gap-4\">\n      <Card class=\"h-fit\">\n        <Content>\n          <div class=\"markdown-content break-words\">\n            {#await markdown($guide.data.getGuide.guide) then guideRendered}\n              <p>{@html guideRendered}</p>\n            {/await}\n          </div>\n        </Content>\n      </Card>\n      <div class=\"grid grid-cols-1 auto-rows-min gap-8\">\n        <GuideInfo guide={$guide.data.getGuide} />\n        <GuideAuthor author={$guide.data.getGuide.user} />\n      </div>\n    </div>\n  </div>\n\n  {#if canUserEdit}\n    <Dialog bind:open={$deleteDialogOpen}>\n      <Title>Delete Guide?</Title>\n      <DialogContent>\n        <div class=\"grid grid-flow-row gap-4\">\n          <span>Are you sure you wish to delete this guide</span>\n\n          <Button variant=\"outlined\" on:click={() => deleteDialogOpen.set(false)}>Cancel</Button>\n          <Button variant=\"outlined\" on:click={() => deleteGuideFn()}>Delete</Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  {/if}\n\n  <Toast bind:running={errorToast}>\n    <span>{errorMessage}</span>\n  </Toast>\n{:else}\n  <!-- TODO Better 404 -->\n  404\n{/if}\n"],"names":["load","async","params","parent","n","loadWaitForNoFetch","guide","queryStore","query","GetGuideDocument","client","variables","guideId","prettyDate","ctx","created_at","insert_hydration_dev","target","div","anchor","append_hydration_dev","h3","span","strong","br","set_data_dev","t4","t4_value","$$props","t3_value","username","attr_dev","div0","div0_style_value","avatar","base","id","div5","div4","div3","div2","a","div1","dirty","t3","author","description","data","getGuide","short_description","title","name","metadescriptors_changes","t0_value","create_if_block_4","user","create_if_block_3","h1","current","t0","guideauthor_changes","error","message","p","t1","t1_value","innerHTML","raw_value","handle_promise","promise","markdown","info","fetching","create_if_block_5","getContextClient","errorMessage","errorToast","deleteDialogOpen","writable","deleteGuideFn","mutation","DeleteGuideDocument","toPromise","then","value","console","$$invalidate","goto","click_handler","set","$deleteDialogOpen","canUserEdit","$user","roles","deleteContent","$guide"],"mappings":"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"}