{"version":3,"file":"18.df0d2d95.js","sources":["../../../../../../src/routes/mod/[modId]/version/[versionId]/+page.ts","../../../../../../src/lib/components/versions/VersionDescription.svelte","../../../../../../src/lib/components/versions/VersionInfo.svelte","../../../../../../src/routes/mod/[modId]/version/[versionId]/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\nimport { queryStore } from '@urql/svelte';\nimport { GetModVersionDocument } from '$lib/generated';\nimport { loadWaitForNoFetch } from '$lib/utils/gql';\n\nexport const load: PageLoad = async ({ params, parent }) => ({\n  ...params,\n  ...(await loadWaitForNoFetch({\n    version: queryStore({\n      query: GetModVersionDocument,\n      client: (await parent()).client,\n      variables: { version: params.versionId }\n    })\n  }))\n});\n","<script lang=\"ts\">\n  import { markdown } from '$lib/utils/markdown';\n  import Card, { Content } from '@smui/card';\n\n  export let changelog!: string;\n</script>\n\n<Card class=\"h-fit\">\n  <Content>\n    <div class=\"markdown-content\">\n      {#await markdown(changelog) then changelogRendered}\n        <p>{@html changelogRendered}</p>\n      {/await}\n    </div>\n  </Content>\n</Card>\n","<script lang=\"ts\">\n  import type { Version } from '$lib/generated';\n  import Card, { Content } from '@smui/card';\n  import { prettyBytes, prettyDate, prettyNumber } from '$lib/utils/formatting';\n\n  export let version!: Pick<Version, 'created_at' | 'sml_version' | 'size' | 'stability' | 'downloads' | 'hash'>;\n</script>\n\n<Card>\n  <Content>\n    <div class=\"text-lg break-words\">\n      <h3 class=\"text-2xl my-4 font-bold\">Info</h3>\n      <span><strong>Created:</strong> {prettyDate(version.created_at)}</span><br />\n      <span><strong>Downloads:</strong> {prettyNumber(version.downloads)}</span><br />\n      <span><strong>SML Version:</strong> {version.sml_version}</span><br />\n      <span><strong>Stability:</strong> {version.stability}</span><br />\n      <span><strong>Size:</strong> {prettyBytes(version.size)}</span><br />\n      <span><strong>Hash:</strong> {version.hash}</span>\n    </div>\n  </Content>\n</Card>\n","<script lang=\"ts\">\n  import { DeleteVersionDocument } from '$lib/generated';\n  import VersionDescription from '$lib/components/versions/VersionDescription.svelte';\n  import VersionInfo from '$lib/components/versions/VersionInfo.svelte';\n  import MetaDescriptors from '$lib/components/utils/MetaDescriptors.svelte';\n  import { API_REST } from '$lib/core';\n  import Toast from '$lib/components/general/Toast.svelte';\n  import { writable } from 'svelte/store';\n  import { goto } from '$app/navigation';\n  import { user } from '$lib/stores/user';\n  import { base } from '$app/paths';\n  import Button, { Label, Icon } from '@smui/button';\n  import Dialog, { Title, Content as DialogContent } from '@smui/dialog';\n  import Menu from '@smui/menu';\n  import List, { Item } from '@smui/list';\n  import { installMod } from '$lib/stores/launcher';\n  import { prettyArch } from '$lib/utils/formatting';\n  import { getContextClient } from '@urql/svelte';\n  import type { PageData } from './$types';\n\n  export let data: PageData;\n\n  const { modId, versionId, version } = data;\n\n  const client = getContextClient();\n\n  let errorMessage = '';\n  let errorToast = false;\n  let menu: Menu;\n\n  $: canUserEdit =\n    $user?.roles?.deleteContent ||\n    $version?.data?.getVersion.mod?.authors?.findIndex((author) => author.user_id == $user?.id) >= 0;\n\n  const deleteDialogOpen = writable<boolean>(false);\n\n  const deleteVersionFn = () => {\n    client\n      .mutation(DeleteVersionDocument, { versionId })\n      .toPromise()\n      .then((value) => {\n        if (value.error) {\n          console.error(value.error.message);\n          errorMessage = 'Error deleting version: ' + value.error.message;\n          errorToast = true;\n        } else {\n          // TODO Toast or something\n          goto(base + '/mod/' + modId);\n        }\n      });\n  };\n</script>\n\n<svelte:head>\n  {#if !$version.fetching && !$version.error && $version.data.getVersion}\n    <MetaDescriptors\n      description=\"Information for mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\"\n      title=\"Mod version {$version.data.getVersion.mod.name} {$version.data.getVersion.version}\" />\n  {/if}\n</svelte:head>\n\n{#if $version.fetching}\n  <p>Loading...</p>\n{:else if $version.error}\n  <p>Oh no... {$version.error.message}</p>\n{:else if $version.data.getVersion}\n  <div class=\"grid gap-6 xlx:grid-flow-row\">\n    <div class=\"flex flex-wrap h-auto justify-between items-center\">\n      <h1 class=\"text-4xl font-bold\">\n        {$version.data.getVersion.mod.name}\n        Version {$version.data.getVersion.version}\n      </h1>\n\n      <div class=\"grid grid-flow-col gap-4\">\n        {#if canUserEdit}\n          <Button variant=\"outlined\" on:click={() => goto(base + '/mod/' + modId + '/version/' + versionId + '/edit')}>\n            Edit\n          </Button>\n          <Button variant=\"outlined\" on:click={() => deleteDialogOpen.set(true)}>Delete</Button>\n        {/if}\n        {#if $version.data.getVersion.arch.length != 0}\n          <Button variant=\"outlined\" on:click={() => menu.setOpen(true)}>\n            <Label>Download</Label>\n            <Icon class=\"material-icons\" style=\"margin: 0;\">arrow_drop_down</Icon>\n          </Button>\n          <Menu bind:this={menu} anchorCorner=\"BOTTOM_LEFT\">\n            <List>\n              {#each $version.data.getVersion.arch as arch}\n                <Item>\n                  <Button\n                    variant=\"outlined\"\n                    class=\"w-full\"\n                    href={API_REST + '/mod/' + modId + '/versions/' + versionId + '/' + arch.platform + '/download'}\n                    >Download {prettyArch(arch.platform)}</Button>\n                </Item>\n              {/each}\n            </List>\n          </Menu>\n        {:else}\n          <Button variant=\"outlined\" href={base + '/mod/' + modId + '/version/' + versionId}>View</Button>\n          <Button variant=\"outlined\" href={API_REST + '/mod/' + modId + '/versions/' + versionId + '/download'}\n            >Download</Button>\n        {/if}\n        <Button variant=\"outlined\" on:click={() => installMod($version.data.getVersion.mod.mod_reference)}>\n          <Label>Install</Label>\n          <Icon class=\"material-icons\">download</Icon>\n        </Button>\n\n        <Button variant=\"outlined\" href={base + '/mod/' + modId}>\n          <Label>Mod</Label>\n          <Icon class=\"material-icons\">extension</Icon>\n        </Button>\n      </div>\n    </div>\n    <div class=\"grid grid-auto-max auto-cols-fr gap-4\">\n      <VersionDescription changelog={$version.data.getVersion.changelog} />\n      <div class=\"grid grid-cols-1 auto-rows-min gap-8\">\n        <VersionInfo version={$version.data.getVersion} />\n      </div>\n    </div>\n  </div>\n\n  {#if canUserEdit}\n    <Dialog bind:open={$deleteDialogOpen}>\n      <Title id=\"simple-title\">Delete Version?</Title>\n      <DialogContent>\n        <div class=\"grid grid-flow-row gap-4\">\n          <span>Are you sure you wish to delete this version</span>\n\n          <Button variant=\"outlined\" on:click={() => deleteDialogOpen.set(false)}>Cancel</Button>\n          <Button variant=\"outlined\" on:click={() => deleteVersionFn()}>Delete</Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  {/if}\n\n  <Toast bind:running={errorToast}>\n    <span>{errorMessage}</span>\n  </Toast>\n{:else}\n  <!-- TODO Better 404 -->\n  404\n{/if}\n"],"names":["load","async","params","parent","loadWaitForNoFetch","version","queryStore","query","GetModVersionDocument","client","variables","versionId","ctx","insert_hydration_dev","target","p","anchor","innerHTML","raw_value","handle_promise","promise","markdown","info","div","dirty","changelog","$$props","prettyDate","created_at","prettyNumber","downloads","t12_value","sml_version","t16_value","stability","prettyBytes","size","t24_value","hash","append_hydration_dev","h3","span0","strong0","br0","span1","strong1","br1","span2","strong2","br2","span3","strong3","br3","span4","strong4","br4","span5","strong5","set_data_dev","t4","t4_value","t8","t8_value","t12","t16","t20","t20_value","t24","description","data","getVersion","mod","name","title","metadescriptors_changes","t0_value","t2_value","create_if_block_5","arch","length","base","create_if_block_3","div4","div1","h1","div0","div3","div2","current","t0","t2","versiondescription_changes","error","message","t1","t1_value","href","API_REST","prettyArch","platform","button_changes","each_value","i","each_blocks","span","fetching","create_if_block_6","modId","getContextClient","errorMessage","errorToast","menu","deleteDialogOpen","writable","deleteVersionFn","mutation","DeleteVersionDocument","toPromise","then","value","console","$$invalidate","goto","set","setOpen","$$value","installMod","$version","mod_reference","$deleteDialogOpen","canUserEdit","$user","roles","deleteContent","authors","findIndex","author","user_id","id"],"mappings":"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"}